{% include 'partials/header_noaa.html' %}
    <div id="my_title" class="d-flex justify-content-center">
        <h1>Hexagon Test</h1>
    </div><br>

    <canvas id="canvasMap" width="800" height="512" style="width: 800px; height: 512px;"></canvas>
    <div class="d-flex justify-content-center">
        <div id="map" style="width: 1200px; height: 800px;"></div>
    </div>
    <!--canvas id="gradientContainer" width="1000" height="600"></canvas-->

    {% load static %}
    <!--script src="{% static 'scripts/gsod_scripts/normalize_coordinates.js' %}"></script>
    <script src="{% static 'scripts/gsod_scripts/temp_to_rgb.js' %}"></script>
    <script src="{% static 'scripts/gsod_scripts/bi.js' %}"></script-->
    <script src="{% static 'scripts/gsod_scripts/hexagon_grid.js' %}"></script>

    <script>
        //var mapbox_token = '{{ mapbox_access_token }}';
        /*
            {
                "elevation": 35.7,
                "mindate": "2005-08-01",
                "maxdate": "2009-10-01",
                "latitude": 61.17472,
                "name": "ANCHORAGE ARCTIC AND INTERNATIONAL, AK US",
                "datacoverage": 0.8624,
                "id": "COOP:500272",
                "elevationUnit": "METERS",
                "longitude": -149.905
            },
            {
                "elevation": 4.6,
                "mindate": "2002-08-08",
                "maxdate": "2020-05-28",
                "latitude": 71.3213,
                "name": "UTQIA VIK FORMERLY BARROW 4 ENE, AK US",
                "datacoverage": 1,
                "id": "WBAN:27516",
                "elevationUnit": "METERS",
                "longitude": -156.611
            },
        */

        data = [
            {"geometry": {"coordinates":[-149.905,61.17472]}, "properties": {"title": 22}},
            {"geometry": {"coordinates":[-156.611,71.3213]}, "properties": {"title": -40}},
            {"geometry": {"coordinates":[-130.611,72.0000]}, "properties": {"title": -40}}
        ]
        console.log(data);
        jQuery(document).ready(function() {

            //var editor=bi(1000,600,data,document.getElementById("gradientContainer"));

        });

        // values are pixels
        var perceived_radius = 20;
        var pixel_radius = calculate_radius(perceived_radius, 52)[0];
        console.log('Pixel Radius', pixel_radius);

        // greatest distance (E-W) for the contiguous 48 US states: 4,669 km [wiki]
        // 50 km is at latitude 40; 1 degree longitude at lat 40 = 84.9898 km
        // the ratio was 50 / 84.9898 degrees
        // (NS) radius of earth is 39940.653 / (2pi)
        /*
        *   at latitude 50:
        *   the latitude circle radius = 6356.7524 * cos 50 = 4086.0417 km
        *   circle 2piR = 4086.0417 * 2 * pi = 25673.3569
        *   1 degree longitude at latitude 50 = 25673.3569 / 360 = 71.3149 km
        *   calculate lat 50 radius using the 50 km reference for lat 40: 50 / 84.9898 * 71.3149 = 41.9550 km
        */
        // this means the grid at the top is 41.9550, so  4669 km / 41.9550 km = 112 rounded up
        // lat 40 radius of 20 km means grid is 278 -- round up to 280

        // alaska calculation; from 52 lat, to 72 lat, roughly 2200 km
        //var pixel_radius_min = calculate_radius(perceived_radius, 52);
        //var pixel_radius_max = calculate_radius(perceived_radius, 72);
        //console.log("Pixel Radii:", pixel_radius_min, pixel_radius_max);
        // 2200 / (Math.sqrt(3) * 20) * 4 ~= 254, but needed 275??

        var startPoints = create_start_points(pixel_radius, 176, 125, 5, 5);
        //console.log(startPoints);

        // TESTING calculator
        console.log('CALCULATIONS:', calculate_latitude(111/6, 52, 6));

        // find the hexagon for the weather stations
        for (var dat in data) {
            lat = data[dat].geometry.coordinates[1];
            console.log("data loop", perceived_radius);
            find_hexagon_rows(perceived_radius, lat, -170.335167, 52, pixel_radius, 176, 125);
        }

        for (var sp in startPoints) {
            //console.log(startPoints[sp]);
            coordinates = ["canvasMap"].concat(single_hexagon.apply(this, startPoints[sp]));
            coordinates = coordinates.concat("rgba(255,0,0,0.5)");
            //console.log(coordinates);
            draw_hexagon.apply(this, coordinates);
        }

        mapboxgl.accessToken = '{{ mapbox_access_token }}';
        var map = new mapboxgl.Map({
            container: 'map',
            zoom: 3,
            minZoom: 3,
            // center: [-100, 36], US center -- roughly
            center: [-149, 63],
            style: 'mapbox://styles/mapbox/streets-v11'
        });

        map.on('load', function() {
            map.addSource('canvas-source', {
                type: 'canvas',
                canvas: 'canvasMap',
                coordinates: [
                [-170.335167, 52], // this is bottom left corner
                [-129.002495, 52],
                [-129.002495, 72],
                [-170.335167, 72]  // this is the top left corner
                ],
                // Set to true if the canvas source is animated. If the canvas is static, animate should be set to false to improve performance.
                animate: false
            });

            map.addLayer({
                id: 'canvas-layer',
                type: 'raster',
                source: 'canvas-source'
            });
        });

    </script>

{% include 'partials/footer_noaa.html' %}
