{% include 'partials/header_noaa.html' %}
    <div id="my_title" class="d-flex justify-content-center">
        <h1>Highest Daily Temperature in USA</h1>
    </div><br>

    <div class="d-flex justify-content-center">
        <div class="col-md-2"></div>
        <div class="col-md-8">
            <p>The temperature layer added to this map is made out of general interest. The radius of each
            of the hexagons in the grid is 15 km. With the projection of the map, that radius may differ based
            on the latitude. To add temperature gradient, a ring is calculated around each of the weather
            stations. The temperature is adjusted in between weather stations based on a factor of -1 times
            the number of rings away from each station.</p>
        </div>
        <div class="col-md-2"></div>
    </div>

    <div class="d-flex justify-content-center">
        <div class="col-md-2"></div>
        <div class="col-md-3">
            <select id="data-type-select" class="form-control">
                <option selected value="TMAX">Maximum Temperature °C</option>
                <!--option value="TMIN">Minimum Temperature °C</option>
                <option value="PRCP">Rainfall (mm)</option>
                <option value="SNOW">Snowfall (mm)</option>
                <option value="SNWD">Snow Depth (mm)</option-->
            </select>
        </div>
        <div class="col-md-1"></div>
        <div class="col-md-3">
            <div id="slider-div">
                <label onchange="load_new_hexagon_file()">Date: <span id="dateLabel">{{ start_date }}</span></label>
                <div id="date-slider" class="ui-slider"></div>
            </div>
        </div>
        <div class="col-md-1">
            <div id="loader" class="loader" style="display: none"></div>
        </div>
        <div class="col-md-2"></div>
    </div><br>

    <div class="d-flex justify-content-center">
        <div id="map" style="width: 1200px; height: 800px;"></div>
    </div><br>

    <!-- node.js library: turf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/5.1.6/turf.min.js"></script>
    {% load static %}
    <script src="{% static 'scripts/gsod_scripts/mapbox_constructor2.js' %}"></script>
    <script src="{% static 'scripts/gsod_scripts/hexagon_grid.js' %}"></script>
    <script src="{% static 'scripts/gsod_scripts/hexgrid_constructor.js' %}"></script>

    <script>
        // variable declarations

        // mapbox
        var mapbox_token = '{{ mapbox_access_token }}';
        var hexGrid;
        var mapUSA;

        // selectors
        var dataDate = '{{ start_date }}';
        var endDate = '{{ end_date }}';
        var parseTime = d3.timeParse("%Y-%m-%d");
        var formatTime = d3.timeFormat("%Y-%m-%d");
        var default_datatype = 'TMAX';

        // slider
        $("#date-slider").slider({
            max: parseTime(endDate).getTime(),
            min: parseTime(dataDate).getTime(),
            value: parseTime(dataDate).getTime(),
            step: (24 * 60 * 60 * 1000),  // milliseconds in a day
            slide: function(event, ui){
                $("#dateLabel").text(formatTime(new Date(ui.value)));
                /*get_json_data("str1", function(data) {
                    hexGrid = data;
                    //mapUSA.wrangleData();
                });*/
            }
        });

        // when document is ready, make API request
        $(document).ready(function() {

            // make the get request for the JSON file
            get_json_data(dataDate, function(data) {
                hexGrid = data;

                // instantiate MapUSA
                mapUSA = new MapUSA('map', 1200, 800, '_yVariable', '_selDate');
            });
        });

        // make GET request to retrieve all stations
        function get_json_data(dataDate, callback) {

            getURL = "/api/get_hexgrid";

            $.ajax({
                url: getURL,
                data: {'dataDate': dataDate},
                success: function(data) {
                    // run callback to return this data
                    //console.log(data);
                    callback(data);
                }
            });
        }

    </script>

{% include 'partials/footer_noaa.html' %}
